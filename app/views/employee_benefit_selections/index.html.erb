<p id="notice"><%= notice %></p>

<div class="ben-selections">
  <h1><%= @employee.display_name %> - Benefit Selections</h1>
</div>

<% if @employee.benefit_eligible %>
<div class="ben-selections">
  <table>
    <thead>
      <tr>
        <th>Provider</th>
        <th>Type</th>
        <th>Plan</th>
        <th>Effective Date</th>
        <% if current_user.manager? && @employee.user_id == current_user.id %>
          <th>Rate Options</th>
          <th>Actions</th>
        <% elsif current_user.manager? %>
          <th>Actions</th>
        <% elsif current_user.employee? %>
          <th>Rate Options</th>
        <% end %>
        <th>Amount</th>         
      </tr>
    </thead>
    <!-- EE's selections -->
    <tbody>
      <% @employee_benefit_selections.each do |employee_benefit_selection| %>
        <tr>
          <td><%= employee_benefit_selection.benefit_profile.provider%></td>
          <td><%= employee_benefit_selection.benefit_type %></td> 
          <td><%= employee_benefit_selection.benefit_profile.provider_plan %></td>
          <td><%= employee_benefit_selection.benefit_profile.effective_date.strftime("%D") %></td>                  
          <!-- EE is eligible but needs birthday in EE record -->           
          <% if @employee.benefit_eligible && @employee.date_of_birth == nil && current_user.employee_id == employee_benefit_selection.employee_id %>
            <td><%= link_to 'Add birthday', edit_company_employee_path(@employee.company, @employee) %></td>
          <!-- Remove link if rate already selected to set amount -->
          <% elsif employee_benefit_selection.amount != nil && employee_benefit_selection.amount >= 0 %>
            <td><span><%= "Rate Selected" %></span></td>
          <% elsif @employee.benefit_eligible? && current_user.employee_id == employee_benefit_selection.employee_id %>
            <!-- Need check that benefit detail has rates imported or it crashes -->
            <td><%= link_to 'Benefit Rate', company_employee_employee_benefit_selection_path(employee_benefit_selection.employee.company, employee_benefit_selection.employee, employee_benefit_selection) %></td>
          
          <% end %>

          <% if current_user.manager? && employee_benefit_selection.amount == nil %>
            <td><%= link_to 'Edit', edit_company_employee_employee_benefit_selection_path(employee_benefit_selection.employee.company, employee_benefit_selection.employee, employee_benefit_selection) %>
            <%= " | " %>
            <%= link_to 'Destroy', company_employee_employee_benefit_selection_path(employee_benefit_selection.employee.company, employee_benefit_selection.employee, employee_benefit_selection), method: :delete, data: { confirm: 'Are you sure?' } %>
            </td>
          <% elsif current_user.manager? && employee_benefit_selection.amount >= 0 %>
            <td><%= link_to 'Destroy', company_employee_employee_benefit_selection_path(employee_benefit_selection.employee.company, employee_benefit_selection.employee, employee_benefit_selection), method: :delete, data: { confirm: 'Are you sure?' } %>
            </td>
          <% end %>
          <!-- acount for nil values in amount -->
          <% if employee_benefit_selection.amount == nil %>
            <td><%= "N/A" %></td>
          <% else %>
            <td><%= number_to_currency(employee_benefit_selection.amount) %></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <h2><%= "Employee not eligible for benefits" %></h2>
  <% if current_user.manager? %>
    <span style="font-size: 20px;"><%= link_to 'Make eligible?', edit_company_employee_path(@employee.company, @employee)%></span>
  <% else %>
    <span style="font-size: 20px; color: green;"><%= "Contact manager or supervisor about eligibility" %></span>
  <% end %>
<% end %>

<br>
<span style="color: red;"><%= "** Rates must first be imported to calculate Benefit Rate Options" %></span>
<br><br>

  <% if current_user.manager? %>
    <%= link_to 'New Employee benefit selection', new_company_employee_employee_benefit_selection_path %> |
    <%= link_to 'Company Benefit Profiles', company_benefit_profiles_path() %> |
    <%= link_to 'View Company Employees', company_employees_path %> 
  <% else %>
    <%= link_to 'Home', root_path %>
  <% end %>
  <%= " | " %>
  <%= link_to 'View Dependents', company_employee_dependents_path(current_user.company_id, current_user.employee_id) %>
</div>