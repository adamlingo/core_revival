<p id="notice"><%= notice %></p>

<div class="ben-selections">
  <h1><%= @employee.display_name %> - Benefit Selections</h1>
</div>

<% if @employee.benefit_eligible %>
<div class="ben-selections">
  <table>
    <thead>
      <tr>
        <th>Provider</th>
        <th>Plan</th>
        <th>Benefit type</th>
        <% if current_user.manager? && @employee.user_id == current_user.id %>
          <th>Rate Options</th>
          <th>Actions</th>
        <% elsif current_user.manager? %>
          <th>Actions</th>
        <% elsif current_user.employee? %>
          <th>Rate Options</th>
        <% end %>       
      </tr>
    </thead>
    <!-- EE's selections -->
    <tbody>
      <% @employee_benefit_selections.each do |employee_benefit_selection| %>
        <tr>
          <td><%= employee_benefit_selection.benefit_profile.provider%></td>
          <td><%= employee_benefit_selection.benefit_profile.provider_plan %></td>
          <td><%= employee_benefit_selection.benefit_type %></td>                    
                     
          <% if @employee.benefit_eligible && @employee.date_of_birth == nil && current_user.employee_id == employee_benefit_selection.employee_id %>
            <td><%= link_to 'Add birthday', edit_company_employee_path(@employee.company, @employee) %></td>
          <% elsif @employee.benefit_eligible? && employee_benefit_selection.benefit_accept == nil && current_user.employee_id == employee_benefit_selection.employee_id %>
            <td><%= link_to 'Benefit Rate', company_employee_employee_benefit_selection_path(employee_benefit_selection.employee.company, employee_benefit_selection.employee, employee_benefit_selection) %></td>
          <% elsif employee_benefit_selection.benefit_accept == true %>
            <td><%= "Rate Accepted!" %></td>
          <% elsif employee_benefit_selection.benefit_accept == false %>
            <td><%= "Rate Declined" %></td>
          <% end %>

          <% if current_user.manager? %>
            <td><%= link_to 'Edit', edit_company_employee_employee_benefit_selection_path(employee_benefit_selection.employee.company, employee_benefit_selection.employee, employee_benefit_selection) %>
            <%= " | " %>
            <%= link_to 'Destroy', company_employee_employee_benefit_selection_path(employee_benefit_selection.employee.company, employee_benefit_selection.employee, employee_benefit_selection), method: :delete, data: { confirm: 'Are you sure?' } %>
            </td> 
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
  <!-- Dependent table -->
  <% if @dependents.count > 0 %>
    <table><br>
      <thead> <h2>Dependents</h2>
        <tr>
          <th>Last Name</th>
          <th>First Name</th>
          <th>Relationship</th>
          <th>Rate Options</th>    
        </tr>
      </thead>
      <tbody>
        <% @dependents.each do |dependent| %>
          <tr>
            <td><%= dependent.last_name %></td>
            <td><%= dependent.first_name %></td>
            <td><%= dependent.relationship %></td>
            <td><%= link_to "Benefit Rate" %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>

<% else %>
  <h2><%= "Employee not eligible for benefits" %></h2>
  <% if current_user.manager? %>
    <span style="font-size: 20px;"><%= link_to 'Make eligible?', edit_company_employee_path(@employee.company, @employee)%></span>
  <% else %>
    <span style="font-size: 20px; color: green;"><%= "Contact manager or supervisor about eligibility" %></span>
  <% end %>
<% end %>


<br><br><br>


  <% if current_user.manager? %>
    <%= link_to 'New Employee benefit selection', new_company_employee_employee_benefit_selection_path %> |
    <%= link_to 'Company Benefit Profiles', company_benefit_profiles_path() %> |
    <%= link_to 'View Company Employees', company_employees_path %> 
  <% else %>
    <%= link_to 'Home', root_path %>
  <% end %>
</div>