<p id="notice"><%= notice %></p>

<div class="ben-selections">
  <h1><%= @employee.display_name %> - Benefit Selections</h1>
</div>

<% if @employee.benefit_eligible %>
<div class="ben-selections">
  <table>
    <thead>
      <tr>
        <th>Provider</th>
        <th>Plan</th>
        <th>Benefit type</th>
        <% if current_user.manager? && @employee.user_id == current_user.id %>
          <th>Rate Options</th>
          <th>Actions</th>
        <% elsif current_user.manager? %>
          <th>Actions</th>
        <% elsif current_user.employee? %>
          <th>Rate Options</th>
        <% end %>
        <th>Amount</th>         
      </tr>
    </thead>
    <!-- EE's selections -->
    <tbody>
      <% @employee_benefit_selections.each do |employee_benefit_selection| %>
        <tr>
          <td><%= employee_benefit_selection.benefit_profile.provider%></td>
          <td><%= employee_benefit_selection.benefit_profile.provider_plan %></td>
          <td><%= employee_benefit_selection.benefit_type %></td>                    
                     
          <% if @employee.benefit_eligible && @employee.date_of_birth == nil && current_user.employee_id == employee_benefit_selection.employee_id %>
            <td><%= link_to 'Add birthday', edit_company_employee_path(@employee.company, @employee) %></td>
          <% elsif employee_benefit_selection.amount != nil && employee_benefit_selection.amount >= 0 %>
            <td><span color: green><%= "Rate Selected" %></span></td>
          <% elsif @employee.benefit_eligible? && current_user.employee_id == employee_benefit_selection.employee_id %>
            <!-- Need check that benefit detail has rates imported or it crashes -->
            <td><%= link_to 'Benefit Rate', company_employee_employee_benefit_selection_path(employee_benefit_selection.employee.company, employee_benefit_selection.employee, employee_benefit_selection) %></td>
          
          <% end %>

          <% if current_user.manager? %>
            <td><%= link_to 'Edit', edit_company_employee_employee_benefit_selection_path(employee_benefit_selection.employee.company, employee_benefit_selection.employee, employee_benefit_selection) %>
            <%= " | " %>
            <%= link_to 'Destroy', company_employee_employee_benefit_selection_path(employee_benefit_selection.employee.company, employee_benefit_selection.employee, employee_benefit_selection), method: :delete, data: { confirm: 'Are you sure?' } %>
            </td> 
          <% end %>
          <!-- acount for nil values in amount -->
          <% if employee_benefit_selection.amount == nil %>
            <td><%= "N/A" %></td>
          <% else %>
            <td><%= number_to_currency(employee_benefit_selection.amount) %></td>
          <% end %>
        </tr>
      <% end %>
    </tbody>
  </table>
  <!-- Dependent table -->
  <% if @dependents.count > 0 %>
    <table><br>
      <thead> <h2>Dependents</h2>
        <tr>
          <th>Last Name</th>
          <th>First Name</th>
          <th>Relationship</th>
          <th>Age</th>
          <th colspan="2">Actions</th>  
        </tr>
      </thead>
      <tbody>
        <% @dependents.each do |dependent| %>
          <tr>
            <td><%= dependent.last_name %></td>
            <td><%= dependent.first_name %></td>
            <td><%= dependent.relationship %></td>
            <td><%= dependent.dep_age(dependent.date_of_birth) %></td>
            <td><%= link_to "Show", company_employee_dependent_path(current_user.company_id, current_user.employee_id, dependent.id) %></td>
            <td><%= link_to "Edit", edit_company_employee_dependent_path(current_user.company_id, current_user.employee_id, dependent.id) %></td>            
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
<% else %>
  <h2><%= "Employee not eligible for benefits" %></h2>
  <% if current_user.manager? %>
    <span style="font-size: 20px;"><%= link_to 'Make eligible?', edit_company_employee_path(@employee.company, @employee)%></span>
  <% else %>
    <span style="font-size: 20px; color: green;"><%= "Contact manager or supervisor about eligibility" %></span>
  <% end %>
<% end %>

<br>
  <!-- conditional add button for own dependents -->
  <% if @employee.user_id == current_user.id %>
    <span class="btn btn-success"><i class='fa fa-user'></i>
    <%= link_to 'Add Dependent', new_company_employee_dependent_path, {style: "color: white"} %></span>
  <% end %>
<br><br><br>


  <% if current_user.manager? %>
    <%= link_to 'New Employee benefit selection', new_company_employee_employee_benefit_selection_path %> |
    <%= link_to 'Company Benefit Profiles', company_benefit_profiles_path() %> |
    <%= link_to 'View Company Employees', company_employees_path %> 
  <% else %>
    <%= link_to 'Home', root_path %>
  <% end %>
</div>